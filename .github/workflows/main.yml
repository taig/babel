# This file was automatically generated by sbt-blowout and should not be edited manually.
# Instead, run blowoutGenerate after making the desired changes to your build definition.
name: CI & CD
'on':
  push:
    branches:
    - main
    tags:
    - '*.*.*'
jobs:
  lint:
    name: Fatal warnings and code formatting
    runs-on: ubuntu-latest
    needs: []
    if: null
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: JDK
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: temurin
        cache: sbt
    - run: sbt -Dmode=ci blowoutCheck
    - run: sbt -Dmode=ci scalafmtCheckAll
    - run: sbt -Dmode=ci compile
  test:
    name: Unit tests
    runs-on: ubuntu-latest
    needs: []
    if: null
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: JDK
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: temurin
        cache: sbt
    - run: sbt +test
  documentation:
    name: Documentation
    runs-on: ubuntu-latest
    needs: []
    if: null
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: JDK
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: temurin
        cache: sbt
    - run: sbt documentation/paradox
    - name: Upload
      uses: actions/upload-artifact@v3
      with:
        name: documentation
        path: ./modules/documentation/.jvm/target/paradox/site/main/
        if-no-files-found: error
        retention-days: 3
  deploy-artifacts:
    name: Deploy artifacts
    runs-on: ubuntu-latest
    needs:
    - test
    - lint
    - documentation
    if: null
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: JDK
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: temurin
        cache: sbt
    - run: sbt -Dmode=release ci-release
      env:
        PGP_PASSPHRASE: ${{secrets.PGP_PASSPHRASE}}
        PGP_SECRET: ${{secrets.PGP_SECRET}}
        SONATYPE_PASSWORD: ${{secrets.SONATYPE_PASSWORD}}
        SONATYPE_USERNAME: ${{secrets.SONATYPE_USERNAME}}
  deploy-documentation:
    name: Deploy documentation
    runs-on: ubuntu-latest
    needs:
    - test
    - lint
    - documentation
    if: startsWith(github.ref, 'refs/tags/')
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
    - name: JDK
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: temurin
        cache: sbt
    - name: Download artifact
      uses: actions/download-artifact@v4.1.7
      with:
        name: documentation
        path: ./documentation
    - name: Deploy
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages
        folder: documentation
